var i=document.querySelector("rl-display");function o(t,e,r,n){let a=Math.abs(t-r),s=Math.abs(e-n);return Math.max(a,s)}function w(t){let e={ch:t};switch(t){case".":e.fg="#aaa";break;case"#":e.fg="#666";break}return e}var c={hero:[0,0]},m=[];function f(t){return c[t]}function p(t,e){return m.filter(r=>o(t,e,...r)==1)}function B(t,e,r){if(t==" ")return;switch(t){case"@":c.hero=[e,r],t=".";break}t=="."&&m.push([e,r]);let n=w(t);i.draw(e,r,n)}function d(){let e=document.querySelector("[type=map]").textContent.trim().split(`
`),r=0;e.forEach((n,a)=>{r=Math.max(r,n.length),n.split("").forEach((s,x)=>B(s,x+1,a+1))}),i.rows=e.length+2,i.cols=r+2}var l=[];function b(t){l.push(t),i.draw(t.x,t.y,t.visual,{id:t.id,zIndex:1})}function y(){let[t,e]=f("hero");b({name:"Hector the ...",id:"hero",x:t,y:e,visual:{ch:"@",fg:"red"},goal:{type:"idle"}})}function k(t){let e=p(t.x,t.y),[r,n]=e.random();return t.x=r,t.y=n,i.move(t.id,r,n)}function P(t,e){console.log("attack")}function v(t,e){return o(t.x,t.y,e.x,e.y)<=1}function M(t){switch(t.goal.type){case"idle":return k(t);case"attack":return v(t,t.goal.target)?P(t,t.goal.target):(t.goal.target,void 0)}}async function h(){let t=l.shift();t&&(console.log(t.name),await M(t),l.push(t))}function T(t){return new Promise(e=>setTimeout(e,t))}Array.prototype.random=function(){return this[Math.floor(Math.random()*this.length)]};function q(){d(),y()}async function C(){for(;;)await h(),await T(1e3)}q();C();
