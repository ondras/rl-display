var a=document.querySelector("rl-display");function m(t,e,n,r){let i=Math.abs(t-n),o=Math.abs(e-r);return Math.max(i,o)}function x(t,e,n,r){let i=t-n,o=e-r;return Math.sqrt(i**2+o**2)}function g(t){return new Promise(e=>setTimeout(e,t))}Array.prototype.random=function(){return this[Math.floor(Math.random()*this.length)]};function A(t){let e={ch:t};switch(t){case"/":e.fg="saddlebrown";break;case".":e.fg="#aaa";break;case"#":e.fg="#666";break}return e}var p={hero:[0,0],spawn1:[],spawn2:[],spawn3:[]},h=[];function w(t){let e=`spawn${t}`;return p[e].random()}function b(t){return p[t]}function d(t,e){return h.filter(n=>m(t,e,...n)==1)}function T(t,e,n){if(t==" ")return;switch(t){case"@":p.hero=[e,n],t=".";break;case"1":case"2":case"3":let i=`spawn${t}`;p[i].push([e,n]),t=".";break}(t=="."||t=="/")&&h.push([e,n]);let r=A(t);a.draw(e,n,r)}function k(){let e=document.querySelector("[type=map]").textContent.trim().split(`
`),n=0;e.forEach((r,i)=>{n=Math.max(n,r.length),r.split("").forEach((o,u)=>T(o,u+1,i+1))}),a.rows=e.length+2,a.cols=n+2}var l=[],s={name:"Hector the ...",id:"hero",x:0,y:0,visual:{ch:"@",fg:"red"},goal:{type:"idle"}};function M(t){l.push(t),a.draw(t.x,t.y,t.visual,{id:t.id,zIndex:1})}function P(){let[t,e]=b("hero");s.x=t,s.y=e,M(s)}function q(t){let e=d(t.x,t.y),[n,r]=e.random();return t.x=n,t.y=r,a.move(t.id,n,r)}function E(t,e){if(console.log("attack"),e!=s){a.delete(e.id);let n=l.indexOf(e);l.splice(n)}}function G(t,e){return m(t.x,t.y,e.x,e.y)<=1}function S(t,e){let n=d(t.x,t.y),r=[],i=1/0;n.forEach(y=>{let c=x(...y,e.x,e.y);c<i&&(i=c,r=[]),c==i&&r.push(y)});let[o,u]=r.random();return t.x=o,t.y=u,t==s&&a.panTo(o,u,100),a.move(t.id,o,u,100)}function C(t){switch(t.goal.type){case"idle":return q(t);case"attack":return G(t,t.goal.target)?E(t,t.goal.target):S(t,t.goal.target)}}function D(){let t=Math.floor(Math.random()*3)+1,[e,n]=w(t),r={name:"orc",id:Math.random(),visual:{ch:"o",fg:"lime"},x:e,y:n,goal:{type:"attack",target:s}};M(r),s.goal={type:"attack",target:r}}async function v(){let t=l.shift();await C(t),l.length||D(),l.push(t)}function I(){k(),P()}async function K(){for(;;)await v(),await g(300)}I();K();
